# Copilot instructions for OpenGL.Net

Purpose
- Help an AI coding agent become productive in this repository quickly: how the code is organized, where code is generated, how to build/regenerate, and important conventions to preserve.

Big picture
- This repo is a multi-project .NET solution (`OpenGL.Net.sln`) providing managed OpenGL bindings, object libraries and math utilities.
- The core runtime is in `OpenGL.Net/` with additional libraries in `OpenGL.Net.Objects/` and `OpenGL.Net.Math/`.
- `OpenGL.Net` and `OpenGL.Net.Objects` does not provide device/windowing abstraction; platform-specific projects (e.g. `OpenGL.Net.WinForms/`, `OpenGL.Net.GTK3/`) provide context creation and integration with UI toolkits.
- A dedicated code-generator `BindingsGen/` consumes Khronos XML specs in `GLSpecs/` and `RefPages/` to produce the `Gl.*`, `Egl.*`, `Wgl.*` and `Glx.*` source files under `OpenGL.Net/` (these generated files contain the comment "This file is automatically generated").

Build & developer workflows
- Preferred full build: open the solution in Visual Studio 2022 or use provided VS Code tasks.
- Important VS Code tasks (see workspace tasks):
  - `Restore` -> runs `dotnet restore ${workspaceFolder}/OpenGL.Net.sln`.
  - `Build` -> runs MSBuild via VS 2022 environment (vcvars64) to build `OpenGL.Net.sln`.
  - `Generate APIs` -> runs the built generator `${workspaceFolder}/BindingsGen/bin/Release/BindingsGen.exe` and depends on `Build`.
- Quick steps to regenerate API source:
  1) Run `Restore` (or `dotnet restore OpenGL.Net.sln`).
  2) Run `Build` (or the `MSBuild (VS 2022)` task so `BindingsGen` builds). The `Build` task calls vcvars64 and MSBuild.
  3) Run `Generate APIs` task. This executes `BindingsGen.exe` (see `BindingsGen/bin/Release/`), which reads `GLSpecs/` & `RefPages/` and writes generated C# into the tree.

Development environments:

- Windows: Visual Studio 2022 is the primary supported IDE. The solution file `OpenGL.Net.sln` is compatible with VS 2022. Use the provided VS Code tasks for building outside VS.
- Windows/Linux/WSL2: VS Code with the C# extension is supported. Use the provided tasks to build and regenerate code. VS Code tasks shall be compatible with Windows and Linux.

Conventions and patterns to preserve
- Generated files are authoritative for OpenGL symbols. Do not hand-edit files containing "This file is automatically generated"; if a change is needed, update `BindingsGen` or the spec inputs as ultimate option.
- Generated code uses partial classes (`partial class Gl`) and many small files grouped by extension/feature (e.g. `EXT`, `ARB`, `KHR`, `NV`, `AMD`, `...` directories). Use the same splitting when adding generator output.
- Project files: some projects are old-style or multi-target; pay attention to `PlatformTarget` and `Prefer32Bit` in samples. Many `.csproj` files set `AllowUnsafeBlocks` or reference native-specific assemblies.

Search tips for maintainers/agents
- Find generated files: search for `"This file is automatically generated"` or the `#pragma warning` blocks present at top of generated files.
- Where generator reads specs: `BindingsGen/` and `GLSpecs/` (e.g. `GLSpecs/gl.xml`).
- To inspect doc handlers: grep for `RegistryDocumentationHandler` implementations.

Testing and samples
- Tests use various frameworks (some projects reference `nunit.framework`). See `OpenGL.Net.*.Test` projects for test configurations.
- Samples may assume platform bitness (x86/x64) and reference native dependencies; use the sample project's `Prefer32Bit` and `PlatformTarget` properties when running.

Gotchas & notes
- Building on CI or machine without Visual Studio: the provided MSBuild tasks rely on `vcvars64.bat` to set the VS build environment. On headless CI prefer a VS build agent or explicitly install MSBuild and set environment variables.
- `BindingsGen` is a .NET Framework (`net48`) console app that depends on `Mono.Cecil` (see `BindingsGen.csproj`). Make sure it builds to produce `BindingsGen.exe` before running the generator task.
- DTD / RefPages: the generator's documentation handlers expect `RefPages/DTD` to exist and contain local copies of W3C DTDs; missing DTDs cause XML resolution failures.

